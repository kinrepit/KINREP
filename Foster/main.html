<html ng-app="fosApp">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>AppBuilder + Ionic = <3</title>

    <script src="cordova.js"></script>
    <link href="http://code.ionicframework.com/1.0.0-beta.11/css/ionic.css" rel="stylesheet">
    <script src="http://code.ionicframework.com/1.0.0-beta.11/js/ionic.bundle.js">
    </script>
    <script>
         var fosApp = angular.module( 'fosApp', ["ionic"])
            fosApp.factory('fosFactory', function($http) {
            return {
                getAssignments: function(callback) {
                    $http
                        .get('https://www.kinrep.com/foster/ws/virtualroomservice.asmx/getFOSAssignments', {
                            params: {
                                foscode: localStorage.getItem("FOSCode")
                            }
                        })
                    .success(callback);
                }
              };
        });
         fosApp.controller( "fosController", function( $scope, fosFactory ) {
               $scope.assignees = [];
               $scope.groups = [];
            fosFactory.getAssignments(function(results) {
                var d = results.replace('<?xml version="1.0" encoding="utf-8"?>', '').replace('<string xmlns="http://tempuri.org/">', '').replace('</string>', '');
                $scope.assignees = JSON.parse(d);
                                $scope.groups[0] = {
                  name: 'BSLI',
                  assignees: $scope.assignees,
                  show: false,
                  totleads: Object.keys($scope.assignees).length
                                    
                };

                });
               $scope.assignee_details = function(p, r) {
                   localStorage.setItem("ActivePolicy", p);
                   if(r == null)
                       window.location.href = 'cheque-pickup.html';
                   else
                       window.location.href = 'Deposit.html';
               }
              $scope.toggleGroup = function(group) {
                group.show = !group.show;
              };
              $scope.isGroupShown = function(group) {
                return group.show;
              };
        });
        //                $http.get('https://www.kinrep.com/foster/ws/virtualroomservice.asmx/getFOSAssignments', {
//    params: { foscode: localStorage.getItem("FOSCode") }}).then(function(data){

                /*.success(function (data, status, headers, config) {
                $scope.groceries = data;
            })
            .error(function (data, status, header, config) {
                $scope.ResponseDetails = "Data: " + data +
                    "<br />status: " + status +
                    "<br />headers: " + jsonFilter(header) +
                    "<br />config: " + jsonFilter(config);
            });*/
            /*$scope.groceries = [
                "Bananas", "Apples", "Oranges", "Milk", "Eggs", "Bread",
                "Cereal", "Beef", "Napkins", "Cheese", "Peanut Butter"
            ];*/
        //});
    </script>
</head>
<body ng-controller="fosController">
    <ion-header-bar class="bar-positive">
        <h1 class="title">Your Assignments</h1>
    </ion-header-bar>
    <ion-content scroll="false">
        <div class="card-wrapper">
            <div class="card custom-card">
                <ion-scroll>
        <ion-list>
            <div ng-repeat="group in groups">
                <ion-item class="item-stable"
                    ng-click="toggleGroup(group)"
                    ng-class="{active: isGroupShown(group)}">
              <i class="icon" ng-class="isGroupShown(group) ? 'ion-minus' : 'ion-plus'"></i>
            &nbsp;
            {{group.name + ' (Pending: ' + group.totleads + ')'}}
          </ion-item>
                <ion-item class="item-accordion" ng-repeat="assignee in group.assignees track by $index" item="assignee" ng-click="assignee_details(assignee.policy_no, assignee.receipt_no)" ng-show="isGroupShown(group)">
                <h2>{{ assignee.owner_name }}</h2>
                <p>{{ assignee.appointment_date + ' ' + assignee.appointment_time }}</p>
            </ion-item>
                </div>
        </ion-list>
                    </ion-scroll>
                </div>
            </div>
    </ion-content>
</body>
</html>